<!DOCTYPE html>
<html>
<head>
    <title>Get Clipboard HTML and RTF</title>
    <style>

        textarea {
            border: 1px solid #808080;
            float: left;
            height: 200px;
            width: 100%;
            overflow: auto;
            margin-bottom: 20px;;
        }

    </style>
	<script src="../../ckeditor.js"></script>
</head>
<body>
    <p>Paste Inside the Editor:</p>
    <div><textarea id="input"></textarea></div>
	<div>
		<div style="float: left; width: 49%">
			<p>Raw HTML Data Received:</p>
			<textarea data-name="input.html" id="rawHtml" readonly="readonly"></textarea>
			<button id="htmlData">Save HTML Data</button>
		</div>
		<div style="float: right; width: 49%">
			<p>Raw RTF Data Received:</p>
			<textarea data-name="input.rtf" id="rawRtf" readonly="readonly"></textarea>
			<button id="rtfData">Save RTF Data</button>
		</div>
	</div>
	<div style="width: 100%; float: left;">
		<p>After Paste Processing:</p>
		<textarea id="output" readonly="readonly"></textarea>
	</div>

	<script>
	var editor = CKEDITOR.replace( 'input', {
		height: 100,
		allowedContent: true,
		plugins: 'pastefromword,pastefromwordimage,wysiwygarea'
	} );

	editor.on( 'paste', function( evt ) {
		var val = evt.data.dataValue;

		if ( evt.data.dataTransfer && evt.data.dataTransfer.getData( 'text/html', true ) ) {
			val = evt.data.dataTransfer.getData( 'text/html', true );
		}
		document.getElementById( 'rawHtml' ).value = val;

		if ( evt.data.dataTransfer && evt.data.dataTransfer.getData( 'text/rtf', true ) ) {
			val = evt.data.dataTransfer.getData( 'text/rtf', true );
		}
		document.getElementById( 'rawRtf' ).value = val;

	}, null, null, -1 );

	editor.on( 'paste', function( evt ) {
		setTimeout( function() {
			document.getElementById( 'output' ).value = editor.getData();
		}, 0 );
	}, null, null, 999 );

	var rtfButton = document.getElementById( 'rtfData' ),
		htmlButton = document.getElementById( 'htmlData' );

	rtfButton.onclick = saveAsFile( document.getElementById( 'rawRtf' ) );
	htmlButton.onclick = saveAsFile( document.getElementById( 'rawHtml' ) );

	function saveAsFile( input ) {
		return function() {

			function destroyClickedElement( event ) {
				// remove the link from the DOM
				document.body.removeChild(event.target);
			}

			var textFileAsBlob = new Blob( [ input.value ], { type: 'text/plain' });
			var fileNameToSaveAs = input.dataset.name;
			var downloadLink = document.createElement("a");

			downloadLink.download = fileNameToSaveAs;
			downloadLink.innerHTML = "Download File";
			if ( window.webkitURL != null ) {
				// Chrome allows the link to be clicked without actually adding it to the DOM.
				downloadLink.href = window.webkitURL.createObjectURL( textFileAsBlob );
			} else {
				// Firefox requires the link to be added to the DOM before it can be clicked.
				downloadLink.href = window.URL.createObjectURL( textFileAsBlob );
				downloadLink.onclick = destroyClickedElement;
				downloadLink.style.display = "none";
				document.body.appendChild(downloadLink);
			}

			downloadLink.click();

		}
	}


	</script>
</body>
</html>
